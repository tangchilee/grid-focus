<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åº§æ¨™ç–Šç–Šæ¨‚ - å°ˆæ¥­å°ˆæ³¨åŠ›è¨“ç·´å·¥å…·</title>
    <!-- è¼‰å…¥ Noto Serif TC å­—é«” -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ React æ ¸å¿ƒ -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- è¼‰å…¥ Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- è¼‰å…¥ html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* å…¨åŸŸæ¨£å¼èˆ‡ OCD ç›’æ¨¡å‹ */
        * { font-family: 'Noto Serif TC', serif !important; box-sizing: border-box; }
        body { background-color: #fff7ed; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; min-height: 100vh; overflow-x: hidden; }

        /* é›»è…¦ç‰ˆé è¦½å›ºå®šæ•¸å€¼ - ç”¨æ–¼ç²¾ç¢ºå°é½Šè¨ˆç®— */
        :root {
            --grid-preview-w: clamp(180px, 22vw, 240px); /* ä¿æŒå¤§å°ºå¯¸ */
            --preview-layout-gap: 15px;                  /* å€åŸŸä¹‹é–“çš„å¤§é–“è· */
            --inner-grid-gap: 32px;                      /* è§€å¯Ÿå€å…§å…©æ ¼é–“è· (gap-8) */
            --container-padding: 32px;                   /* å®¹å™¨å…§è· (p-8) */
            --border-width: 4px;                         /* é‚Šæ¡†å¯¬åº¦ */
        }

        /* æ ¸å¿ƒå…¬å¼ï¼šè¨ˆç®—å€åŸŸç¸½å¯¬åº¦ï¼Œç”¨æ–¼æŒ‰éˆ•èˆ‡æ¨™ç±¤ 100% åˆ‡é½Š */
        .full-obs-width {
            width: calc((2 * var(--grid-preview-w)) + var(--inner-grid-gap) + (2 * var(--container-padding)) + (2 * var(--border-width)));
        }
        .full-ans-width {
            width: calc(var(--grid-preview-w) + (2 * var(--container-padding)) + (2 * var(--border-width)));
        }
        
        /* åº•éƒ¨æŒ‰éˆ•ç¸½å¯¬åŒæ­¥å…¬å¼ï¼šè§€å¯Ÿå€å¯¬ + ä½œç­”å€å¯¬ + ä¸­é–“ layout gap */
        .total-sync-width {
            width: calc((3 * var(--grid-preview-w)) + var(--inner-grid-gap) + (4 * var(--container-padding)) + (4 * var(--border-width)) + var(--preview-layout-gap));
            max-width: 100%;
        }

        @media (min-width: 768px) and (max-width: 1280px) and (pointer: coarse) {
            html, body, #root { height: 100vh; height: 100dvh; overflow: hidden; }
            .app-container { height: 100vh; height: 100dvh; display: flex; flex-direction: column; }
            .content-flex-1 { flex: 1; min-height: 0; display: flex; flex-direction: column; }
        }

        @media (max-width: 767px) {
            :root {
                --grid-preview-w: 22vw;        /* æ‰‹æ©Ÿç‰ˆå¤§å¹…ç¸®å°æ ¼å­å¯¬åº¦ï¼Œç¢ºä¿ä¸è¶…å‡º */
                --inner-grid-gap: 6px;         /* ç¸®æ¸›æ‰‹æ©Ÿç‰ˆå…§éƒ¨é–“è· */
                --container-padding: 10px;     /* ç¸®æ¸›æ‰‹æ©Ÿç‰ˆå…§è· */
                --border-width: 2.5px;
                --preview-layout-gap: 10px;
            }
            /* ä¿®æ­£ï¼šåƒ…å°æ§åˆ¶åˆ—æŒ‰éˆ•å®¹å™¨åœ¨æ‰‹æ©Ÿç‰ˆè¨­ç‚º 100%ï¼ŒéŠæˆ²å€å¡Šå¯¬åº¦ç¶­æŒ calc è¨ˆç®— */
            .control-row .full-obs-width, 
            .control-row .full-ans-width,
            .total-sync-width {
                width: 100%;
            }
        }

        @media print { .no-print { display: none !important; } }
        button { outline: none; }
        
        .custom-scrollbar::-webkit-scrollbar { width: 4px; height: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #fef3c7; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #ff8c42; border-radius: 10px; }

        .pop-animation { animation: pop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        @keyframes pop { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* æ»¿ç‰ˆæ¨™ç±¤æ¨£å¼ï¼šèˆ‡å¤§ç›’å­é‚Šç·£å®Œå…¨åˆ‡é½Š */
        .area-label {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 40px;
            width: 100%; /* å¼·åˆ¶å¡«æ»¿å®¹å™¨å¯¬åº¦ */
            border-radius: 15px 15px 0 0;
            font-weight: 900;
            font-size: 16px;
            color: white;
            letter-spacing: 0.15em;
            margin-bottom: -1px;
            z-index: 10;
        }

        .toggle-container {
            background-color: white;
            border-radius: 10px;
            padding: 2px;
            border: 2px solid #f9ebbe;
            display: flex;
            height: 48px;
            width: 100%;
        }
        .toggle-btn {
            flex: 1;
            border-radius: 8px;
            font-weight: 900;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        .toggle-btn.active { background-color: #ff8c42; color: white; box-shadow: 0 2px 4px rgba(255, 140, 66, 0.2); }
        .toggle-btn.inactive { color: #433422; opacity: 0.6; }

        .unified-btn {
            height: 48px;
            border-radius: 12px;
            font-weight: 900;
            font-size: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            color: white;
            box-shadow: 0 3px 0 rgba(0,0,0,0.12);
            width: 100%;
        }
        .unified-btn:active { transform: translateY(2px); box-shadow: 0 1px 0 rgba(0,0,0,0.12); }

        .fade-in { animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback, memo } = React;

        const Icons = {
            Info: (p) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" {...p}><circle cx="12" cy="12" r="10" /><line x1="12" y1="16" x2="12" y2="12" /><line x1="12" y1="8" x2="12.01" y2="8" /></svg>,
            X: (p) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" {...p}><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></svg>,
            RefreshCw: (p) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M21 2v6h-6"/><path d="M3 12a9 9 0 0 1 15-6.7L21 8"/><path d="M3 22v-6h6"/><path d="M21 12a9 9 0 0 1-15 6.7L3 16"/></svg>,
            ImageIcon: (p) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" {...p}><rect width="18" height="18" x="3" y="3" rx="2" ry="2" /><circle cx="9" cy="9" r="2" /><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21" /></svg>,
            CheckCircle: (p) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
            Sparkles: (p) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="m12 3 1.912 5.813a2 2 0 0 0 1.275 1.275L21 12l-5.813 1.912a2 2 0 0 0-1.275 1.275L12 21l-1.912-5.813a2 2 0 0 0-1.275-1.275L3 12l5.813-1.912a2 2 0 0 0 1.275-1.275L12 3Z" /></svg>
        };

        const TreasureChestIcon = ({ sizeClass = "w-[65%] h-[65%]", exportMode = false }) => (
            <svg viewBox="0 0 64 64" className={`${sizeClass} drop-shadow-md ${exportMode ? 'transform -translate-y-[20%]' : ''}`}>
                <rect x="8" y="30" width="48" height="24" rx="4" className="fill-amber-700 stroke-amber-900" strokeWidth="2" />
                <path d="M8 30h48v-8c0-8.837-7.163-16-16-16H24C15.163 6 8 13.163 8 22v8z" className="fill-amber-600 stroke-amber-900" strokeWidth="2" />
                <rect x="8" y="28" width="48" height="4" className="fill-amber-900 opacity-20" />
                <rect x="28" y="26" width="8" height="10" rx="2" className="fill-yellow-400 stroke-amber-900" strokeWidth="2" />
                <circle cx="32" cy="31" r="1.5" className="fill-amber-900" />
            </svg>
        );

        const GridComponent = memo(({ items, onCellClick, isInteractive, type, status, gridSize, gameMode, exportMode = false }) => {
            const is3x3 = gridSize === 3;
            const cols = is3x3 ? 3 : 4;
            const rows = 3;
            const aspectRatio = is3x3 ? '1/1' : '4/3';
            
            // ä¿®æ­£ï¼šå°å‡ºç‰ˆå¯¬åº¦èª¿æ•´ç‚º 245pxï¼Œä¿ç•™é‚Šç·£ç©ºç™½
            const gridWidth = exportMode ? 'w-[245px]' : 'w-[var(--grid-preview-w)]';

            const getIcon = (active) => {
                if (!active) return null;
                
                // æ ¸å¿ƒä¿®æ­£ï¼šå°å‡ºç‰ˆ (exportMode) å¼·åŒ–è² å‘ä½ç§» translate-y-[-20%]ã€‚é¦–é å‰‡ç¶­æŒ -2px æ ¡æ­£
                const iconClass = `flex items-center justify-center leading-none h-full w-full ${
                    exportMode ? 'text-4xl transform -translate-y-[20%]' : 'text-xl sm:text-2xl md:text-3xl transform -translate-y-[2px]'
                }`;
                
                if (gameMode === 'standard') {
                    if (type === 'tool') return <span className={iconClass}>ğŸ”¨</span>;
                    if (type === 'target') return <span className={iconClass}>ğŸ¥š</span>;
                    return <span className={`${iconClass} pop-animation`}>ğŸ£</span>;
                } else {
                    if (type === 'tool') return <span className={iconClass}>ğŸ”‘</span>;
                    if (type === 'target') return <TreasureChestIcon sizeClass={exportMode ? "w-[60%] h-[60%]" : "w-[65%] h-[65%]"} exportMode={exportMode} />;
                    return <span className={`${iconClass} pop-animation`}>ğŸ’°</span>;
                }
            };

            return (
                <div className={`flex flex-col shrink-0 ${gridWidth}`}>
                    <div 
                        className={`grid border-[4px] border-stone-800 bg-white overflow-hidden rounded-2xl transition-all shadow-md
                            ${type === 'result' && status === 'correct' ? 'ring-4 ring-emerald-100 border-emerald-500' : ''}
                            ${type === 'result' && status === 'wrong' ? 'ring-4 ring-rose-100 border-rose-500 shadow-sm' : ''}
                        `}
                        style={{ 
                            aspectRatio: aspectRatio, 
                            display: 'grid', 
                            gridTemplateRows: `repeat(${rows}, 1fr)`,
                            gridTemplateColumns: `repeat(${cols}, 1fr)` 
                        }}
                    >
                        {items.map((active, i) => (
                            <div
                                key={i}
                                onClick={() => isInteractive && onCellClick(i)}
                                className={`border-[1.2px] border-stone-300 flex items-center justify-center w-full h-full min-w-0 min-h-0 relative
                                    ${isInteractive ? 'cursor-pointer hover:bg-orange-50 active:bg-orange-100' : ''}
                                `}
                            >
                                {getIcon(active)}
                            </div>
                        ))}
                    </div>
                </div>
            );
        });

        const App = () => {
            const [gridSize, setGridSize] = useState(4); 
            const [gameMode, setGameMode] = useState('standard'); 
            const [levels, setLevels] = useState([]);
            const [isChecking, setIsChecking] = useState(false);
            const [isExporting, setIsExporting] = useState(false);
            const [showGuide, setShowGuide] = useState(false);
            const [checkResult, setCheckResult] = useState(null);
            const exportContainerRef = useRef(null);

            const currentTotalLevels = gridSize === 3 ? 4 : 5;

            const generateNewGame = useCallback(() => {
                const totalCells = gridSize === 3 ? 9 : 12;
                const requiredCount = gridSize === 3 ? 5 : 7; 
                const newLevels = Array.from({ length: currentTotalLevels }, () => {
                    const hammers = Array(totalCells).fill(false);
                    const eggs = Array(totalCells).fill(false);
                    const hIndices = [...Array(totalCells).keys()].sort(() => Math.random() - 0.5).slice(0, requiredCount);
                    hIndices.forEach(idx => hammers[idx] = true);
                    const eIndices = [...Array(totalCells).keys()].sort(() => Math.random() - 0.5).slice(0, requiredCount);
                    eIndices.forEach(idx => eggs[idx] = true);
                    return { hammers, eggs, answers: Array(totalCells).fill(false), status: null };
                });
                setLevels(newLevels);
                setIsChecking(false);
                setCheckResult(null);
            }, [gridSize, currentTotalLevels]);

            useEffect(() => { generateNewGame(); }, [generateNewGame]);

            const handleAnswerClick = (levelIdx, cellIdx) => {
                const newLevels = [...levels];
                newLevels[levelIdx] = { ...newLevels[levelIdx] };
                newLevels[levelIdx].answers = [...newLevels[levelIdx].answers];
                newLevels[levelIdx].answers[cellIdx] = !newLevels[levelIdx].answers[cellIdx];
                newLevels[levelIdx].status = null; 
                setLevels(newLevels);
            };

            const checkAnswers = () => {
                const hasUnfinished = levels.some(level => level.answers.every(ans => ans === false));
                if (hasUnfinished) {
                    setCheckResult({ type: 'info', text: 'é‚„æœ‰é¡Œç›®æ²’åšå®Œå”·' });
                    return;
                }
                let correctCount = 0;
                const newLevels = levels.map(level => {
                    const overlaps = level.hammers.map((h, i) => h && level.eggs[i]);
                    const isLevelCorrect = JSON.stringify(level.answers) === JSON.stringify(overlaps);
                    if (isLevelCorrect) correctCount++;
                    return { ...level, status: isLevelCorrect ? 'correct' : 'wrong' };
                });
                setLevels(newLevels);
                setIsChecking(true);
                const themeName = gameMode === 'standard' ? 'å­µåŒ–' : 'è§£é–å¯¶è—';
                if (correctCount === currentTotalLevels) setCheckResult({ type: 'success', text: `å¤ªæ£’äº†ï¼å…¨éƒ¨${themeName}æˆåŠŸï¼` });
                else setCheckResult({ type: 'error', text: 'æœ‰äº›ä½ç½®ä¸å¤ªå°å–”ï¼Œå†æª¢æŸ¥çœ‹çœ‹ã€‚' });
            };

            const handleExportImage = async () => {
                if (isExporting || !window.html2canvas) return;
                setIsExporting(true);
                const exportArea = exportContainerRef.current;
                exportArea.style.display = 'block';
                try {
                    const canvas = await html2canvas(exportArea, { scale: 3, useCORS: true, backgroundColor: '#ffffff' });
                    const link = document.createElement('a');
                    link.href = canvas.toDataURL("image/png", 1.0);
                    link.download = `åº§æ¨™ç–Šç–Šæ¨‚_è¨“ç·´å–®.png`;
                    link.click();
                } catch (err) { console.error(err); }
                finally { exportArea.style.display = 'none'; setIsExporting(false); }
            };

            return (
                <div className="app-container bg-[#fff7ed] p-2 min-h-screen">
                    <div className="content-flex-1 max-w-[1440px] mx-auto w-full bg-white rounded-[3rem] shadow-2xl border-[12px] border-[#f9ebbe] relative flex flex-col overflow-hidden">
                        
                        {/* ä¿®æ­£ï¼šå°‡ä½¿ç”¨èªªæ˜æŒ‰éˆ•ç§»å‹•åˆ°å³ä¸Šè§’ (top-4 right-4) */}
                        <button onClick={() => setShowGuide(true)} className="absolute top-4 right-4 bg-[#fff9e6] text-[#ff8c42] p-2 rounded-full border-2 border-[#f9ebbe] hover:bg-[#ff8c42] hover:text-white transition-all z-20 shadow-sm no-print"><Icons.Info className="w-6 h-6 sm:w-8 sm:h-8" /></button>

                        <div className="text-center pt-8 pb-1 px-4 shrink-0">
                            <div className="inline-flex items-center gap-2 px-4 py-1 bg-orange-100 text-[#ff8c42] rounded-full text-[11px] font-black tracking-widest mb-2 shadow-sm uppercase">
                                <Icons.Sparkles className="w-3.5 h-3.5" /> æ•™å­¸è¼”åŠ©å·¥å…·
                            </div>
                            <h1 className="text-3xl sm:text-5xl font-[900] text-orange-950 tracking-[0.1em] mb-1 uppercase leading-none">åº§æ¨™ç–Šç–Šæ¨‚</h1>
                            <p className="text-[#433422]/70 font-normal text-[11px] sm:text-[14px] mb-4 uppercase text-center tracking-wide px-4">
                                ç‚ºå°æœ‹å‹æ‰“é€ æœ€æº«é¦¨ã€å°ˆæ¥­çš„è¦–è¦ºæœå°‹èˆ‡ç©ºé–“å°æ‡‰ç·´ç¿’ç©ºé–“
                            </p>
                        </div>

                        {/* ä¿®æ­£æ§åˆ¶é …ï¼šåŠ å…¥ control-row é¡åˆ¥å€åˆ† */}
                        <div className="px-4 sm:px-10 mb-8 flex flex-col items-center shrink-0 w-full no-print">
                            <div className="control-row flex flex-col md:flex-row justify-center items-end gap-[var(--preview-layout-gap)] w-full max-w-full">
                                
                                <div className="flex flex-row gap-[var(--preview-layout-gap)] shrink-0 full-obs-width">
                                    <div className="flex flex-col gap-1 flex-1">
                                        <span className="text-[12px] font-black text-orange-800/40 uppercase text-center w-full">é›£åº¦è¨­å®š</span>
                                        <div className="toggle-container">
                                            <button onClick={() => setGridSize(3)} className={`toggle-btn ${gridSize === 3 ? 'active' : 'inactive'}`}>3X3 è¦æ ¼</button>
                                            <button onClick={() => setGridSize(4)} className={`toggle-btn ${gridSize === 4 ? 'active' : 'inactive'}`}>4X3 æ©«å‘</button>
                                        </div>
                                    </div>
                                    <div className="flex flex-col gap-1 flex-1">
                                        <span className="text-[12px] font-black text-orange-800/40 uppercase text-center w-full">å…§å®¹ä¸»é¡Œ</span>
                                        <div className="toggle-container">
                                            <button onClick={() => setGameMode('standard')} className={`toggle-btn ${gameMode === 'standard' ? 'active' : 'inactive'}`}>æ•²é›è›‹</button>
                                            <button onClick={() => setGameMode('chest')} className={`toggle-btn ${gameMode === 'chest' ? 'active' : 'inactive'}`}>é–‹å¯¶ç®±</button>
                                        </div>
                                    </div>
                                </div>

                                <div className="flex flex-col gap-1 shrink-0 full-ans-width">
                                    <span className="text-[12px] font-black text-transparent select-none uppercase hidden md:block">.</span>
                                    <button onClick={generateNewGame} className="unified-btn bg-stone-700 hover:bg-stone-800 shadow-sm w-full"><Icons.RefreshCw className="w-5 h-5" /> æ›ä¸€çµ„æ–°é¡Œç›®</button>
                                </div>

                            </div>
                        </div>

                        {/* ä¸»éŠæˆ²å€ï¼šç¢ºä¿ flex-row ä¸‹çš„å€å¡Šå¯¬åº¦å— calc é™åˆ¶è€Œé 100% */}
                        <div className="flex-1 overflow-y-auto custom-scrollbar px-2 sm:px-8 pb-6">
                            <div className="flex flex-row justify-center items-start gap-[var(--preview-layout-gap)] w-full py-2">
                                
                                <div className="flex flex-col shrink-0 full-obs-width">
                                    <div className="area-label bg-[#ff8c42]">é¡Œç›®è§€å¯Ÿå€</div>
                                    <div className={`bg-orange-50/50 rounded-b-[2rem] rounded-r-[2rem] p-3 sm:p-8 border-[var(--border-width)] border-orange-100 flex flex-col shadow-inner transition-all items-center ${gridSize === 3 ? 'gap-2' : 'gap-5'}`}>
                                        {levels.map((level, idx) => (
                                            <div key={`q-${idx}`} className="flex flex-row items-center justify-center gap-[var(--inner-grid-gap)] w-full">
                                                <GridComponent items={level.hammers} type="tool" gridSize={gridSize} gameMode={gameMode} />
                                                <div className="w-[1.5px] h-6 sm:h-12 bg-orange-200 opacity-40 shrink-0"></div>
                                                <GridComponent items={level.eggs} type="target" gridSize={gridSize} gameMode={gameMode} />
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className="flex flex-col shrink-0 full-ans-width">
                                    <div className="area-label bg-stone-700">ä½œç­”å€</div>
                                    <div className={`bg-stone-50 rounded-b-[2rem] rounded-r-[2rem] p-3 sm:p-8 border-[var(--border-width)] border-stone-200 flex flex-col shadow-inner transition-all items-center ${gridSize === 3 ? 'gap-2' : 'gap-5'}`}>
                                        {levels.map((level, idx) => (
                                            <div key={`a-${idx}`} className="w-full flex justify-center">
                                                <GridComponent 
                                                    items={level.answers} 
                                                    onCellClick={(cellIdx) => handleAnswerClick(idx, cellIdx)} 
                                                    isInteractive={true} 
                                                    type="result" 
                                                    status={level.status} 
                                                    gridSize={gridSize}
                                                    gameMode={gameMode}
                                                />
                                            </div>
                                        ))}
                                    </div>
                                </div>

                            </div>
                        </div>

                        {/* åº•éƒ¨æŒ‰éˆ• - å°é½ŠåŒæ­¥å¯¬åº¦ */}
                        <div className="p-8 bg-white border-t border-orange-50 shrink-0 no-print flex justify-center w-full">
                            <div className="total-sync-width grid grid-cols-2 gap-8">
                                <button onClick={checkAnswers} className="unified-btn !h-16 !text-lg bg-[#ff8c42] hover:bg-[#ff7a21] shadow-lg"><Icons.CheckCircle className="w-6 h-6" /> æ ¸å°ç·´ç¿’çµæœ</button>
                                <button onClick={handleExportImage} className="unified-btn !h-16 !text-lg bg-stone-800 hover:bg-black shadow-lg">
                                    {isExporting ? <Icons.RefreshCw className="w-5 h-5 animate-spin" /> : <Icons.ImageIcon className="w-6 h-6" />} è¼¸å‡ºåœ–æª”
                                </button>
                            </div>
                        </div>

                        {checkResult && (
                            <div className="absolute inset-0 z-50 flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm no-print" onClick={() => setCheckResult(null)}>
                                <div className="bg-white rounded-[2.5rem] p-10 max-w-xs w-full shadow-2xl border-4 border-orange-100 text-center scale-100 fade-in" onClick={e => e.stopPropagation()}>
                                    <div className="text-7xl mb-6">
                                        {checkResult.type === 'success' ? (gameMode === 'standard' ? 'ğŸ£' : 'ğŸ’°') : checkResult.type === 'info' ? 'ğŸ“' : 'ğŸ”'}
                                    </div>
                                    <h2 className="text-2xl font-black text-orange-950 mb-8">{checkResult.text}</h2>
                                    <button onClick={() => setCheckResult(null)} className="w-full py-4 bg-[#ff8c42] text-white rounded-2xl font-black active:scale-95 shadow-lg shadow-orange-100">çŸ¥é“äº†</button>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* A4 å°å‡ºç‰ˆ - ç¶­æŒéš”é›¢é‚è¼¯ */}
                    <div ref={exportContainerRef} style={{ position: 'fixed', left: '-9999px', top: '0', width: '1000px', height: '1414px', backgroundColor: 'white', padding: '15px 50px 50px 50px', boxSizing: 'border-box', display: 'none' }}>
                        <div style={{ textAlign: 'center', marginBottom: '15px', borderBottom: '3px solid #fff7ed', paddingBottom: '10px' }}>
                            <h1 style={{ fontSize: '56px', fontWeight: '900', color: '#433422', margin: '0 0 10px 0' }}>åº§æ¨™ç–Šç–Šæ¨‚ - å°ˆæ³¨åŠ›è¨“ç·´</h1>
                            <p style={{ fontSize: '20px', color: '#78350f', fontWeight: '700', letterSpacing: '6px' }}>è§€å¯Ÿå·¦å´é¡Œç›®é‡ç–Šä½ç½®ï¼Œä¸¦åœ¨å³å´æ ¼å­ä¸­æ­£ç¢ºæ¨™è¨˜ï¼</p>
                        </div>
                        
                        <div style={{ display: 'flex', flexDirection: 'row', justifyContent: 'center', gap: '40px', alignItems: 'flex-start' }}>
                            <div style={{ display: 'flex', flexDirection: 'column', width: '590px' }}>
                                <div style={{ backgroundColor: '#ff8c42', color: 'white', padding: '6px 0', borderRadius: '15px 15px 0 0', fontWeight: '900', fontSize: '24px', textAlign: 'center' }}>é¡Œç›®è§€å¯Ÿå€</div>
                                <div style={{ border: '4px solid #fed7aa', backgroundColor: '#fffaf5', padding: '25px', borderRadius: '0 30px 30px 30px', display: 'flex', flexDirection: 'column', gap: gridSize === 3 ? '35px' : '20px', alignItems: 'center' }}>
                                    {levels.map((level, idx) => (
                                        <div key={idx} style={{ display: 'flex', alignItems: 'center', gap: '30px' }}>
                                            <GridComponent items={level.hammers} type="tool" gridSize={gridSize} gameMode={gameMode} exportMode={true} />
                                            <div style={{ width: '2.5px', height: '100px', backgroundColor: '#fed7aa', opacity: 0.8 }}></div>
                                            <GridComponent items={level.eggs} type="target" gridSize={gridSize} gameMode={gameMode} exportMode={true} />
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div style={{ display: 'flex', flexDirection: 'column', width: '300px' }}>
                                <div style={{ backgroundColor: '#433422', color: 'white', padding: '6px 0', borderRadius: '15px 15px 0 0', fontWeight: '900', fontSize: '24px', textAlign: 'center' }}>ä½œç­”å€</div>
                                <div style={{ border: '4px solid #e5e7eb', backgroundColor: '#fafafa', padding: '25px', borderRadius: '0 30px 30px 30px', display: 'flex', flexDirection: 'column', gap: gridSize === 3 ? '35px' : '20px', alignItems: 'center' }}>
                                    {Array.from({length: levels.length}).map((_, idx) => (
                                        <GridComponent key={idx} items={Array(gridSize === 3 ? 9 : 12).fill(false)} type="result" gridSize={gridSize} gameMode={gameMode} exportMode={true} />
                                    ))}
                                </div>
                            </div>
                        </div>

                        <div style={{ position: 'absolute', bottom: '40px', width: '100%', textAlign: 'center', color: '#d1d5db', fontSize: '18px', left: '0', fontWeight: 'bold' }}>
                            å°ˆæ¥­æ•™è‚²è¼”åŠ©æ•™æ - ç©ºé–“é‚è¼¯å°æ‡‰è¨“ç·´ç³»åˆ—
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>